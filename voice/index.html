<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ì²­ì£¼ìƒë‹¹ê²½ì°°ì„œ í´-ë³´ì´ìŠ¤</title>
    
    <!-- GA4 ì—°ë™ -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-J4W28Z27Z6"></script>
    <script>
        const GA_MEASUREMENT_ID = 'G-J4W28Z27Z6';
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', GA_MEASUREMENT_ID, { 'page_title': 'í´-ë³´ì´ìŠ¤', 'anonymize_ip': true });
    </script>

    <link rel="apple-touch-icon" href="logo.png">
    <link rel="icon" type="image/png" href="logo.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a237e">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #1a237e; --bg-main: #f3f4f6; --text-main: #1f2937;
            --danger: #ef4444; --safe: #22c55e; --accent: #2563eb;
        }
        body { font-family: 'Noto Sans KR', sans-serif; margin: 0; background-color: var(--bg-main); overflow: hidden; touch-action: manipulation; }
        .bg-police-dark { background-color: var(--primary); }

        /* íƒ­ ì»¨í…ì¸  ì˜ì—­ */
        .content-view { display: none; height: calc(100vh - 60px); overflow-y: auto; padding: 20px; padding-bottom: 100px; }
        .content-view.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* í•˜ë‹¨ íƒ­ë°” (ìŠ¬ë¦¼í™” ë° ì¤‘ì•™ ì •ë ¬) */
        .bottom-nav { 
            position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 100%; max-width: 450px; height: 60px; 
            background: white; border-top: 1px solid #e5e7eb; 
            display: flex; z-index: 40; 
        }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #9ca3af; cursor: pointer; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 1.2rem; margin-bottom: 2px; }

        /* ì‹œë®¬ë ˆì´ì…˜ ì˜¤ë²„ë ˆì´ */
        .sim-overlay {
            position: fixed; inset: 0; z-index: 100; background: #0f172a; color: white;
            display: none; flex-direction: column;
            transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .sim-overlay.active { display: flex; transform: translateY(0); }

        /* ì‚¬ì´ë Œ ì ë©¸ íš¨ê³¼ */
        @keyframes siren-flash {
            0% { background-color: rgba(220, 38, 38, 0.8); }
            50% { background-color: rgba(37, 99, 235, 0.8); }
            100% { background-color: rgba(220, 38, 38, 0.8); }
        }
        .siren-effect { 
            animation: siren-flash 0.25s infinite; position: fixed; inset: 0; 
            z-index: 9999 !important; pointer-events: none; display: flex; align-items: center; justify-content: center;
        }

        /* í›ˆë ¨ ì±„íŒ… UI */
        .chat-bubble {
            background: #1e293b; padding: 20px; border-radius: 4px 20px 20px 20px;
            margin-bottom: 24px; border-left: 5px solid #3b82f6; box-shadow: 0 4px 10px rgba(0,0,0,0.4);
            animation: slideUp 0.4s;
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* ì„ íƒì§€ ë²„íŠ¼ */
        .option-btn {
            width: 100%; text-align: left; padding: 18px; margin-bottom: 12px;
            background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15);
            border-radius: 12px; transition: all 0.2s; font-size: 15px; color: white;
        }
        .option-btn:active { background: rgba(255,255,255,0.2); transform: scale(0.98); }
        .option-btn.good { border-color: var(--safe); background: rgba(34, 197, 94, 0.2); pointer-events: none; }
        .option-btn.bad { border-color: var(--danger); background: rgba(239, 68, 68, 0.2); pointer-events: none; }

        /* í”¼ë“œë°± ë°•ìŠ¤ */
        .feedback-box { 
            display: none; padding: 15px; border-radius: 12px; margin-top: 10px; 
            font-size: 14px; line-height: 1.6; animation: slideUp 0.3s;
        }
        .feedback-box.good { background: #064e3b; color: #a7f3d0; border: 1px solid #10b981; }
        .feedback-box.bad { background: #7f1d1d; color: #fecaca; border: 1px solid #ef4444; }

        /* íŒŒí˜• ë¹„ì£¼ì–¼ë¼ì´ì € */
        .voice-wave span {
            display: inline-block; width: 6px; height: 30px; background: #60a5fa; margin: 0 2px;
            animation: wave 1s infinite ease-in-out;
        }
        .voice-wave span:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave span:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave span:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave span:nth-child(5) { animation-delay: 0.4s; }
        @keyframes wave { 0%, 100% { height: 10px; opacity: 0.5; } 50% { height: 50px; opacity: 1; } }

        /* ê°€ì´ë“œ íƒ­ ë ˆì´ì•„ì›ƒ êµì • */
        .guide-title-box { display: flex; align-items: center; gap: 12px; margin-bottom: 24px; padding-bottom: 15px; border-bottom: 2px solid #e5e7eb; }
        .guide-ci { width: 40px; height: 40px; object-fit: contain; flex-shrink: 0; background: white; border-radius: 50%; padding: 2px; }
        .guide-item { display: flex; gap: 15px; background: white; padding: 20px; border-radius: 16px; border: 1px solid #e5e7eb; margin-bottom: 12px; align-items: flex-start; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .g-num { font-size: 24px; font-weight: 900; color: var(--accent); opacity: 0.7; line-height: 1; margin-top: 2px; }
        .g-txt h3 { margin: 0 0 6px 0; font-size: 17px; color: var(--text-main); font-weight: 800; }
        .g-txt p { margin: 0; font-size: 13.5px; color: #6b7280; line-height: 1.6; text-align: justify; word-break: keep-all; }

        /* í€´ì¦ˆ ì¹´ë“œ ë””ìì¸ */
        .quiz-card { background: white; padding: 20px; border-radius: 16px; margin-bottom: 20px; border: 1px solid #e5e7eb; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .quiz-msg { background: #f1f5f9; color: #334155; padding: 15px; border-radius: 10px; font-size: 14px; line-height: 1.5; margin: 15px 0; border-left: 4px solid var(--accent); }
    </style>
</head>
<body>

<div class="w-full max-w-[450px] bg-white h-screen shadow-2xl flex flex-col relative overflow-hidden mx-auto">
    
    <!-- ì˜¤ë””ì˜¤ ìì› -->
    <audio id="ringtone" loop><source src="ringtone.mp3" type="audio/mpeg"></audio>
    <audio id="voice-player"></audio>
    <audio id="siren-sound"><source src="siren.mp3" type="audio/mpeg"></audio>

    <!-- ì‚¬ì´ë Œ ë ˆì´ì–´ -->
    <div id="siren-overlay" class="hidden">
        <i class="fa-solid fa-triangle-exclamation text-white text-[120px] animate-ping opacity-80"></i>
    </div>

    <!-- í—¤ë” (ë¡œê³  í¬ê¸° í´-ë§¤ë‹ˆì €ì™€ ì¼ì¹˜í™”) -->
    <header class="h-[60px] px-4 flex items-center justify-between bg-police-dark text-white z-50 shadow-md">
        <div class="flex items-center gap-3">
            <button onclick="location.href='../'" class="p-1 rounded-full hover:bg-blue-900 transition"><i class="fa-solid fa-arrow-left text-xl"></i></button>
            <img src="logo.png" onerror="this.src='https://upload.wikimedia.org/wikipedia/commons/thumb/3/30/Emblem_of_the_Korean_National_Police_Agency.svg/150px-Emblem_of_the_Korean_National_Police_Agency.svg.png'" class="w-10 h-10 object-contain bg-white rounded-full p-0.5">
            <div class="flex flex-col">
                <span class="text-lg font-black leading-none">í´-ë³´ì´ìŠ¤</span>
                <span class="text-[10px] opacity-80 mt-0.5 font-normal">ë³´ì´ìŠ¤í”¼ì‹± ì˜ˆë°© í›ˆë ¨ì†Œ</span>
            </div>
        </div>
        <span class="text-[10px] bg-white/10 px-2 py-1 rounded font-medium">ì²­ì£¼ìƒë‹¹ê²½ì°°ì„œ</span>
    </header>

    <!-- íƒ­ 1: í›ˆë ¨ì†Œ -->
    <div id="view-home" class="content-view active bg-gray-50">
        <div class="bg-gradient-to-br from-blue-800 to-blue-600 rounded-2xl p-6 text-white text-center shadow-lg mb-6">
            <p class="text-lg font-bold">"ë²”ì¸ì˜ ëª©ì†Œë¦¬ë¥¼ ëê¹Œì§€ ë“£ê³ <br>ë‹¨ê³„ë³„ë¡œ ëŒ€ì²˜í•˜ì„¸ìš”!"</p>
        </div>
        
        <div class="flex items-center gap-2 mb-3">
            <i class="fa-solid fa-layer-group text-[#1a237e]"></i>
            <span class="text-sm font-bold text-[#1a237e]">í›ˆë ¨ ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ (6ëŒ€ ì•…ì„±ì‚¬ê¸°)</span>
        </div>

        <div class="grid grid-cols-2 gap-3">
            <button onclick="startSim('prosecutor')" class="bg-white border p-4 rounded-xl shadow-sm hover:shadow-md active:scale-95 flex flex-col items-center">
                <span class="text-3xl mb-2">âš–ï¸</span><span class="text-sm font-bold text-gray-800">ê¸°ê´€ ì‚¬ì¹­</span>
                <span class="text-[10px] text-gray-500">ê²€ì‚¬/ìˆ˜ì‚¬ê´€</span>
            </button>
            <button onclick="startSim('loan')" class="bg-white border p-4 rounded-xl shadow-sm hover:shadow-md active:scale-95 flex flex-col items-center">
                <span class="text-3xl mb-2">ğŸ’°</span><span class="text-sm font-bold text-gray-800">ëŒ€ì¶œ ë¹™ì</span>
                <span class="text-[10px] text-gray-500">ì €ê¸ˆë¦¬ ëŒ€í™˜ëŒ€ì¶œ</span>
            </button>
            <button onclick="startSim('family')" class="bg-white border p-4 rounded-xl shadow-sm hover:shadow-md active:scale-95 flex flex-col items-center">
                <span class="text-3xl mb-2">ğŸ“±</span><span class="text-sm font-bold text-gray-800">ìë…€ ì‚¬ì¹­</span>
                <span class="text-[10px] text-gray-500">ì•¡ì •íŒŒì†/ìƒí’ˆê¶Œ</span>
            </button>
            <button onclick="startSim('romance')" class="bg-white border p-4 rounded-xl shadow-sm hover:shadow-md active:scale-95 flex flex-col items-center">
                <span class="text-3xl mb-2">ğŸ’˜</span><span class="text-sm font-bold text-gray-800">ë¡œë§¨ìŠ¤ ìŠ¤ìº </span>
                <span class="text-[10px] text-gray-500">SNS ì—°ì•  ë¹™ì</span>
            </button>
            <button onclick="startSim('smishing')" class="bg-white border p-4 rounded-xl shadow-sm hover:shadow-md active:scale-95 flex flex-col items-center">
                <span class="text-3xl mb-2">ğŸ’¸</span><span class="text-sm font-bold text-gray-800">ì¬ë‚œì§€ì›ê¸ˆ ì‚¬ì¹­</span>
                <span class="text-[10px] text-gray-500">ìŠ¤ë¯¸ì‹± ë¬¸ì</span>
            </button>
            <button onclick="startSim('invest')" class="bg-white border p-4 rounded-xl shadow-sm hover:shadow-md active:scale-95 flex flex-col items-center">
                <span class="text-3xl mb-2">ğŸ“ˆ</span><span class="text-sm font-bold text-gray-800">íˆ¬ì ì‚¬ê¸°</span>
                <span class="text-[10px] text-gray-500">ë¦¬ë”©ë°©/ì½”ì¸</span>
            </button>
        </div>
        <p class="text-center text-[10px] text-gray-400 mt-8 font-medium">AI Voice provided by Naver Clova Dubbing</p>
    </div>

    <!-- íƒ­ 2: ìŠ¤ë¯¸ì‹± í€´ì¦ˆ -->
    <div id="view-smishing" class="content-view bg-gray-50">
        <!-- [ìˆ˜ì •ë¨] ì™„ë²½í•œ ì¤‘ì•™ ì •ë ¬ ë° ë‹ë³´ê¸° ì•„ì´ì½˜ ìš°ì¸¡ ì´ë™ -->
        <div class="bg-gradient-to-r from-green-600 to-emerald-500 rounded-2xl p-4 text-white text-center mb-6 flex flex-col items-center justify-center shadow-lg">
            <h1 class="text-lg font-black tracking-tight mb-0.5">ìŠ¤ë¯¸ì‹± íƒì§€ì†Œ</h1>
            <div class="flex items-center justify-center gap-2 translate-x-2"> 
                <!-- translate-x-2ë¥¼ í†µí•´ ì•„ì´ì½˜ ë„ˆë¹„ë§Œí¼ í…ìŠ¤íŠ¸ë¥¼ ìš°ì¸¡ìœ¼ë¡œ ì‚´ì§ ë°€ì–´ ë¬¸êµ¬ê°€ ì œëª© ì •ì¤‘ì•™ì— ì˜¤ë„ë¡ êµì • -->
                <p class="text-xs opacity-95">ë¬¸ì ì† <strong>ê°€ì§œ</strong>ë¥¼ ì°¾ì•„ë‚´ì„¸ìš”.</p>
                <i class="fa-solid fa-magnifying-glass text-lg opacity-60"></i>
            </div>
        </div>

        <div class="quiz-card">
            <div class="font-bold text-gray-800 mb-1 text-sm">Q1. ëª¨ë°”ì¼ ì²­ì²©ì¥</div>
            <div class="quiz-msg">[Webë°œì‹ ] ê¹€ì² ìˆ˜â™¥ì´ì˜í¬ ê²°í˜¼í•©ë‹ˆë‹¤.<br>ëª¨ë°”ì¼ ì²­ì²©ì¥: <strong>wedding.invitation.apk</strong></div>
            <div class="flex gap-2">
                <button onclick="alert('ì •ë‹µ! apkëŠ” ì•…ì„± ì•± ì„¤ì¹˜ íŒŒì¼ì…ë‹ˆë‹¤. ì ˆëŒ€ ëˆ„ë¥´ì§€ ë§ˆì„¸ìš”.')" class="flex-1 bg-red-100 text-red-600 py-3 rounded-xl font-bold text-xs active:scale-95 transition">ğŸš¨ ìŠ¤ë¯¸ì‹±ì´ë‹¤</button>
                <button onclick="alert('í‹€ë ¸ìŠµë‹ˆë‹¤. apk íŒŒì¼ì€ ë§¤ìš° ìœ„í—˜í•©ë‹ˆë‹¤.')" class="flex-1 bg-green-100 text-green-600 py-3 rounded-xl font-bold text-xs active:scale-95 transition">âœ… ì •ìƒì´ë‹¤</button>
            </div>
        </div>

        <div class="quiz-card">
            <div class="font-bold text-gray-800 mb-1 text-sm">Q2. íƒë°° ì£¼ì†Œì§€ í™•ì¸</div>
            <div class="quiz-msg">[CJëŒ€í•œí†µìš´] ìš´ì†¡ì¥ë²ˆí˜¸[45***] ì£¼ì†Œì§€ ë¶ˆë¶„ëª….<br>í™•ì¸í•˜ê¸°: <strong>cj-gls.com.kr.xyz</strong></div>
            <div class="flex gap-2">
                <button onclick="alert('ì •ë‹µ! ê³µì‹ ì£¼ì†Œ ë’¤ì— xyz ë“± ì´ìƒí•œ ì˜ì–´ê°€ ë¶™ìœ¼ë©´ 100% ê°€ì§œì…ë‹ˆë‹¤.')" class="flex-1 bg-red-100 text-red-600 py-3 rounded-xl font-bold text-xs active:scale-95 transition">ğŸš¨ ìŠ¤ë¯¸ì‹±ì´ë‹¤</button>
                <button onclick="alert('í‹€ë ¸ìŠµë‹ˆë‹¤. íƒë°°ì‚¬ëŠ” ë§í¬ë¥¼ ë³´ë‚´ì§€ ì•ŠìŠµë‹ˆë‹¤.')" class="flex-1 bg-green-100 text-green-600 py-3 rounded-xl font-bold text-xs active:scale-95 transition">âœ… ì •ìƒì´ë‹¤</button>
            </div>
        </div>

        <div class="quiz-card">
            <div class="font-bold text-gray-800 mb-1 text-sm">Q3. ì¬ë‚œì§€ì›ê¸ˆ ì‹ ì²­</div>
            <div class="quiz-msg">[ì •ë¶€24] ê·€í•˜ëŠ” 5ì°¨ ì¬ë‚œì§€ì›ê¸ˆ ì§€ê¸‰ ëŒ€ìƒì…ë‹ˆë‹¤. ë§ˆê°ì „ ì‹ ì²­í•˜ì„¸ìš”.<br>í™•ì¸: <strong>gov-help.bit.ly</strong></div>
            <div class="flex gap-2">
                <button onclick="alert('ì •ë‹µ! ì •ë¶€ëŠ” ì ˆëŒ€ë¡œ ë‹¨ì¶• URL(bit.ly ë“±)ë¡œ ì•ˆë‚´í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.')" class="flex-1 bg-red-100 text-red-600 py-3 rounded-xl font-bold text-xs active:scale-95 transition">ğŸš¨ ìŠ¤ë¯¸ì‹±ì´ë‹¤</button>
                <button onclick="alert('í‹€ë ¸ìŠµë‹ˆë‹¤. ì •ë¶€ ê³µì‹ ì‚¬ì´íŠ¸ ì£¼ì†Œ(go.kr)ê°€ ì•„ë‹™ë‹ˆë‹¤.')" class="flex-1 bg-green-100 text-green-600 py-3 rounded-xl font-bold text-xs active:scale-95 transition">âœ… ì •ìƒì´ë‹¤</button>
            </div>
        </div>
    </div>

    <!-- íƒ­ 3: ê°€ì´ë“œ (ê¸°ì¡´ ë””ìì¸ ì™„ë²½ ë³µêµ¬) -->
    <div id="view-guide" class="content-view bg-gray-50">
        <div class="guide-title-box">
            <img src="logo.png" alt="CI" class="guide-ci" onerror="this.src='https://upload.wikimedia.org/wikipedia/commons/thumb/3/30/Emblem_of_the_Korean_National_Police_Agency.svg/150px-Emblem_of_the_Korean_National_Police_Agency.svg.png'">
            <span class="text-[19px] font-black text-gray-800 tracking-tight">ë³´ì´ìŠ¤í”¼ì‹± ì˜ˆë°© í–‰ë™ìˆ˜ì¹™</span>
        </div>
        
        <div class="space-y-4">
            <div class="guide-item">
                <div class="g-num">01</div>
                <div class="g-txt">
                    <h3>ë§í¬(URL) í´ë¦­ ê¸ˆì§€</h3>
                    <p>ì¶œì²˜ë¥¼ ì•Œ ìˆ˜ ì—†ëŠ” ë¬¸ì ì† ì¸í„°ë„· ì£¼ì†ŒëŠ” ì ˆëŒ€ ëˆ„ë¥´ì§€ ë§ˆì„¸ìš”.</p>
                </div>
            </div>
            <div class="guide-item">
                <div class="g-num">02</div>
                <div class="g-txt">
                    <h3>ì•± ì„¤ì¹˜ ìš”êµ¬ëŠ” ì‚¬ê¸°</h3>
                    <p>ê²€ì°°, ê²½ì°°, ê¸ˆê°ì›ì€ ì „í™”ë¡œ 'ë³´ì•ˆ ì•±' ì„¤ì¹˜ë¥¼ ìš”êµ¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                </div>
            </div>
            <div class="guide-item">
                <div class="g-num">03</div>
                <div class="g-txt">
                    <h3>ëŠê³ , í™•ì¸ ì „í™”</h3>
                    <p>ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ì „í™”ë¥¼ ë°›ì•˜ë‹¤ë©´ ì¼ë‹¨ ëŠìœ¼ì„¸ìš”. ê·¸ë¦¬ê³  112ë¡œ í™•ì¸í•˜ì„¸ìš”.</p>
                </div>
            </div>
        </div>
        
        <div class="mt-8 p-5 bg-red-50 border border-red-200 rounded-2xl text-center text-red-600 font-black shadow-inner">
            ğŸš¨ ë³´ì´ìŠ¤í”¼ì‹± ì‹ ê³ : êµ­ë²ˆì—†ì´ 112<br>
            â˜ï¸ ê¸ˆìœµê°ë…ì› ìƒë‹´: 1332
        </div>
    </div>

    <!-- í•˜ë‹¨ ê³ ì • ë‚´ë¹„ê²Œì´ì…˜ -->
    <nav class="bottom-nav">
        <div onclick="switchTab('home', this)" class="nav-item active">
            <i class="fa-solid fa-house text-xl mb-1"></i><span class="text-[10px] font-bold">í›ˆë ¨ì†Œ</span>
        </div>
        <div onclick="switchTab('smishing', this)" class="nav-item">
            <i class="fa-solid fa-comment-sms text-xl mb-1"></i><span class="text-[10px] font-bold">ìŠ¤ë¯¸ì‹±</span>
        </div>
        <div onclick="switchTab('guide', this)" class="nav-item">
            <i class="fa-solid fa-book-open text-xl mb-1"></i><span class="text-[10px] font-bold">ê°€ì´ë“œ</span>
        </div>
    </nav>

    <!-- [ì‹œë®¬ë ˆì´ì…˜ ì˜¤ë²„ë ˆì´] -->
    <div id="simScreen" class="sim-overlay">
        <div class="flex items-center justify-between p-4 bg-black/30 border-b border-white/10">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center shadow-lg"><i class="fa-solid fa-user text-white"></i></div>
                <div>
                    <div id="simCaller" class="font-bold text-lg text-white">ë°œì‹ ì</div>
                    <div id="simStepInfo" class="text-[10px] text-gray-400 font-medium tracking-wider">South Korea</div>
                </div>
            </div>
            <button onclick="quitSim()" class="text-xs text-gray-400 border border-gray-600 px-3 py-1 rounded-full hover:text-white transition">ì¢…ë£Œ</button>
        </div>

        <div class="flex-1 p-6 flex flex-col items-center justify-center text-center relative overflow-y-auto">
            
            <!-- (1) ì „í™” ìˆ˜ì‹  í™”ë©´ -->
            <div id="callIncoming" class="w-full h-full flex flex-col justify-between pb-32 pt-10">
                <div>
                    <div class="text-blue-400 text-sm font-bold mb-2 animate-pulse">ìˆ˜ì‹  ì „í™”...</div>
                    <h2 class="text-4xl font-black text-white" id="incomingName">ë°œì‹ ì ì •ë³´</h2>
                </div>
                
                <div class="flex justify-between items-center px-10 w-full mt-auto">
                    <div class="flex flex-col items-center gap-3">
                        <button onclick="declineCall()" class="w-20 h-20 bg-red-600 rounded-full flex items-center justify-center shadow-2xl active:scale-90 transition">
                            <i class="fa-solid fa-phone-slash text-3xl text-white"></i>
                        </button>
                        <span class="text-sm font-bold text-gray-400">ê±°ì ˆ</span>
                    </div>
                    <div class="flex flex-col items-center gap-3">
                        <button onclick="acceptCall()" class="w-20 h-20 bg-green-600 rounded-full flex items-center justify-center shadow-2xl animate-bounce active:scale-90 transition">
                            <i class="fa-solid fa-phone text-3xl text-white"></i>
                        </button>
                        <span class="text-sm font-bold text-gray-400">í†µí™”</span>
                    </div>
                </div>
            </div>

            <!-- (2) ì²­ì·¨ í™”ë©´ -->
            <div id="listeningBox" class="hidden w-full">
                <div class="text-blue-400 font-black mb-8 text-2xl animate-pulse">ë²”ì¸ ëª©ì†Œë¦¬ ë¶„ì„ ì¤‘...</div>
                <div class="voice-wave h-20 flex items-center justify-center gap-2 mb-10">
                    <span></span><span></span><span></span><span></span><span></span><span></span><span></span>
                </div>
                <p class="text-gray-400 text-sm leading-relaxed font-bold">ê²½ì°°ì²­ ë²”ì£„ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¡°íšŒ ì¤‘ì…ë‹ˆë‹¤.<br>ë²”ì¸ì˜ ëª©ì†Œë¦¬ë¥¼ ëê¹Œì§€ ë“£ê³  íŒë‹¨í•˜ì„¸ìš”.</p>
                <button onclick="finishListening()" class="mt-20 text-xs text-gray-500 border-b border-gray-600 pb-1">SKIP (ì†Œë¦¬ê°€ ì•ˆ ë“¤ë¦¬ë©´ í´ë¦­)</button>
            </div>

            <!-- (3) ì‹œë‚˜ë¦¬ì˜¤ ëŒ€ì‘ í™”ë©´ -->
            <div id="scenarioBox" class="hidden w-full text-left pt-5">
                <div class="relative mb-6">
                    <div class="text-blue-400 text-[10px] font-bold mb-1 ml-1 tracking-widest">ì‚¬ê¸°ê¾¼ì˜ ì••ë°• ğŸ“¢</div>
                    <div class="chat-bubble">
                        <h3 id="scenarioText" class="text-lg font-bold leading-relaxed text-white">...</h3>
                    </div>
                </div>

                <div id="optionsArea" class="space-y-3"></div>
                <div id="feedbackArea" class="feedback-box"></div>
                
                <button id="nextBtn" onclick="nextStep()" class="hidden w-full bg-blue-600 hover:bg-blue-500 py-4 rounded-2xl font-black mt-4 shadow-xl active:scale-95 transition">
                    ë‹¤ìŒ ë‹¨ê³„ë¡œ <i class="fa-solid fa-arrow-right ml-1"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- ìµœì¢… ê²°ê³¼ ë¦¬í¬íŠ¸ -->
    <div id="resultScreen" class="fixed inset-0 z-[120] bg-gray-100 hidden overflow-y-auto">
        <div class="bg-white p-8 rounded-b-[40px] shadow-lg text-center">
            <h2 class="text-2xl font-black text-gray-800 mb-2">í›ˆë ¨ ë¦¬í¬íŠ¸</h2>
            <div class="relative w-36 h-36 mx-auto flex items-center justify-center rounded-full border-[10px] border-gray-100 mt-4" id="scoreCircle">
                <span class="text-5xl font-black text-gray-800" id="finalScore">0</span>
            </div>
            <p class="text-sm mt-5 font-bold" id="finalGrade">íŒì •ì¤‘</p>
        </div>
        <div class="p-6 pb-24">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200 mb-5">
                <h3 class="font-bold text-gray-800 mb-4 flex items-center gap-2 text-sm"><i class="fa-solid fa-shield-halved text-blue-600"></i> ê²½ì°°ê´€ì˜ ë§ì¶¤ ì†”ë£¨ì…˜</h3>
                <ul id="feedbackList" class="space-y-4 text-xs text-gray-600 list-disc pl-4 leading-relaxed font-medium"></ul>
            </div>
            <button onclick="quitSim()" class="w-full bg-[#1a237e] text-white py-4 rounded-xl font-black shadow-2xl transition active:scale-95">ë©”ì¸ í™”ë©´ìœ¼ë¡œ</button>
        </div>
    </div>

</div>

<script>
    // === ì‹œë‚˜ë¦¬ì˜¤ DB ===
    const SCENARIOS = {
        'prosecutor': {
            caller: "ì„œìš¸ì¤‘ì•™ì§€ê²€ ì´í˜•ì‚¬", voice: "voice_prosecutor.mp3",
            steps: [
                { txt: "ì„œìš¸ì¤‘ì•™ì§€ê²€ì…ë‹ˆë‹¤. ê·€í•˜ ëª…ì˜ì˜ í†µì¥ì´ ëŒ€í¬í†µì¥ ì‚¬ê¸° ë²”ì£„ì— ì—°ë£¨ë˜ì–´ êµ¬ì†ì˜ì¥ì´ ë°œë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë³¸ì¸ì´ ì§ì ‘ ê°œì„¤í•œ ê²ë‹ˆê¹Œ?", 
                  opts: [{t:"ë„¤? ì œê°€ìš”? ì „ ê·¸ëŸ° ì  ì—†ëŠ”ë°.. ì–´ë–»ê²Œ í•˜ì£ ?", s:'bad', f:"ğŸš¨ [ì£¼ì˜] ë‹¹í™©í•˜ë©´ ë²”ì¸ì˜ í˜ì´ìŠ¤ì— ë§ë ¤ë“­ë‹ˆë‹¤. ìˆ˜ì‚¬ê¸°ê´€ì€ ì „í™”ë¡œ ê°œì¸ ê¸ˆìœµ ì •ë³´ë¥¼ ì ˆëŒ€ ë¬»ì§€ ì•ŠìŠµë‹ˆë‹¤."}, {t:"ì§ì ‘ ë°©ë¬¸í•´ì„œ ì¡°ì‚¬ë°›ê² ìŠµë‹ˆë‹¤. 1301ë¡œ ì§ì ‘ í™•ì¸í•˜ê² ìŠµë‹ˆë‹¤.", s:'good', f:"âœ… [ì •ë‹µ] ì „í™”ë¥¼ ëŠê³  ê³µì‹ë²ˆí˜¸(112, 1301)ë¡œ ì‚¬ì‹¤ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ” ê²ƒì´ ìµœê³ ì…ë‹ˆë‹¤."}] },
                { txt: "í˜„ì¬ ë…¹ì·¨ ì¡°ì‚¬ë¥¼ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤. ì •ë³´ ìœ ì¶œ ë°©ì§€ë¥¼ ìœ„í•´ ì£¼ë³€ì— ì•„ë¬´ë„ ì—†ëŠ” ì¡°ìš©í•œ ë°©ìœ¼ë¡œ ì´ë™í•´ ì£¼ì„¸ìš”.", 
                  opts: [{t:"ë„¤, ì§€ê¸ˆ ë°©ìœ¼ë¡œ ë“¤ì–´ì™”ìŠµë‹ˆë‹¤. ì•„ë¬´ë„ ì—†ì–´ìš”.", s:'bad', f:"ğŸš¨ [ìœ„í—˜] ê³ ë¦½ ìˆ˜ë²•ì…ë‹ˆë‹¤. ì£¼ë³€ì˜ ë„ì›€ì„ ì°¨ë‹¨í•˜ì—¬ ëƒ‰ì •í•œ íŒë‹¨ì„ ëª»í•˜ê²Œ í•˜ë ¤ëŠ” ì˜ë„ì…ë‹ˆë‹¤."}, {t:"ê³µê³µì¥ì†Œë¼ ì´ë™ì´ ì–´ë µìŠµë‹ˆë‹¤. ì •ì‹ ì†Œí™˜ì¥ì„ ë³´ë‚´ì„¸ìš”.", s:'good', f:"âœ… [ì •ë‹µ] ì „í™” ì¡°ì‚¬ëŠ” ê±°ë¶€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ê³µì‹ì ì¸ ë²•ì  ì„œë¥˜ë¥¼ ìš”êµ¬í•˜ì„¸ìš”."}] },
                { txt: "ì‚¬ê±´ ì¡°íšŒë¥¼ ìœ„í•´ ì§€ê¸ˆ ë³´ë‚´ë“œë¦¬ëŠ” ë³´ì•ˆ ë§í¬ë¥¼ ëˆŒëŸ¬ 'ìˆ˜ì‚¬ ì§€ì› ì•±'ì„ ì„¤ì¹˜í•˜ê³  ì‚¬ê±´ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.", 
                  opts: [{t:"ë„¤, ì„¤ì¹˜ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤. ì‚¬ê±´ í™•ì¸í•´ë³¼ê²Œìš”.", s:'bad', f:"ğŸš¨ [ì¹˜ëª…ì ] ì„¤ì¹˜ ì¦‰ì‹œ í°ì´ í•´í‚¹ë©ë‹ˆë‹¤. ì´í›„ 112ì— ê±¸ì–´ë„ ë²”ì¸ì—ê²Œ ì—°ê²°ë˜ëŠ” 'ì „í™” ê°€ë¡œì±„ê¸°'ê°€ ì‹œì‘ë©ë‹ˆë‹¤."}, {t:"ë¬¸ì ë§í¬ëŠ” ì•ˆ ëˆ„ë¦…ë‹ˆë‹¤. ê³µë¬¸ì€ ìš°í¸ìœ¼ë¡œ ë³´ë‚´ì„¸ìš”.", s:'good', f:"âœ… [ì •ë‹µ] ìˆ˜ì‚¬ê¸°ê´€ì€ ì ˆëŒ€ë¡œ ë¬¸ìë¡œ ì•± ì„¤ì¹˜ë¥¼ ìœ ë„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. 100% ì‚¬ê¸°ì…ë‹ˆë‹¤."}] },
                { txt: "ìì‚° ë™ê²°ì„ ë§‰ìœ¼ë ¤ë©´ ê¸ˆê°ì› 'êµ­ê°€ì•ˆì „ê³„ì¢Œ'ë¡œ ì”ì•¡ì„ ì¼ì‹œ ë³´ê´€í•´ì•¼ í•©ë‹ˆë‹¤. ì´ì²´ í›„ ê²€ìˆ˜ë˜ë©´ ëŒë ¤ë“œë¦½ë‹ˆë‹¤.", 
                  opts: [{t:"ì œ ëˆ ë¬¶ì´ë©´ ì•ˆ ë˜ëŠ”ë°.. ì§€ê¸ˆ ë°”ë¡œ ë³´ë‚¼ê²Œìš”.", s:'bad', f:"ğŸš¨ [í”¼í•´ë°œìƒ] 'êµ­ê°€ì•ˆì „ê³„ì¢Œ'ëŠ” ì„¸ìƒì— ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì†¡ê¸ˆí•˜ëŠ” ìˆœê°„ ëˆì€ ì¦ë°œí•©ë‹ˆë‹¤."}, {t:"êµ­ê°€ê¸°ê´€ì´ ê°œì¸ ê³„ì¢Œë¡œ ëˆì„ ë³´ê´€í•´ì£¼ë‚˜ìš”? ì‹ ê³ í•˜ê² ìŠµë‹ˆë‹¤.", s:'good', f:"âœ… [ì™„ë²½í•´ìš”] ê¸ˆì „ ì´ì²´ ìš”êµ¬ëŠ” ë³´ì´ìŠ¤í”¼ì‹±ì˜ ìµœì¢… ë‹¨ê³„ì…ë‹ˆë‹¤. ì ˆëŒ€ ì‘í•˜ì§€ ë§ˆì„¸ìš”."}] },
                { txt: "(ê³ í•¨) ë‹¹ì‹  ì§€ê¸ˆ í˜‘ì¡° ì•ˆ í•˜ë©´ ê³µë¬´ì§‘í–‰ë°©í•´ë¡œ ê°€ì¤‘ ì²˜ë²Œí•©ë‹ˆë‹¤! ì§€ê¸ˆ ë‹¹ì¥ ì²´í¬ì¡° ë³´ëƒ…ë‹ˆë‹¤!", 
                  opts: [{t:"ì˜ëª»í–ˆìŠµë‹ˆë‹¤.. ì‹œí‚¤ëŠ” ëŒ€ë¡œ ë‹¤ í•  í…Œë‹ˆ ì²´í¬ ë§ˆì„¸ìš”.", s:'bad', f:"ğŸš¨ [ìœ„í—˜] ì‹¬ë¦¬ì  ì••ë°•ìœ¼ë¡œ íŒë‹¨ë ¥ì„ íë¦¬ê²Œ í•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤. êµ­ê°€ê¸°ê´€ì€ í˜‘ë°•í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."}, {t:"ì²´í¬í•˜ë ¤ë©´ í•˜ì„¸ìš”. ì €ë„ ì§€ê¸ˆ 112 ì‹ ê³  ì¤‘ì…ë‹ˆë‹¤. (ëš)", s:'good', f:"âœ… [ì •ë‹µ] ì „í™”ë¥¼ ê³¼ê°íˆ ëŠëŠ” ìš©ê¸°ê°€ ê°€ì¥ í° ë¬´ê¸°ì…ë‹ˆë‹¤."}] }
            ]
        },
        'smishing': {
            caller: "ì¬ë‚œì§€ì›ê¸ˆ ì•ˆë‚´", voice: "voice_smishing.mp3",
            steps: [
                { txt: "[1ë‹¨ê³„] [êµ­ë¯¼ì¬ë‚œì•ˆì „ì²˜] ê·€í•˜ëŠ” '6ì°¨ ì¬ë‚œì§€ì›ê¸ˆ' ì‹ ì²­ ëŒ€ìƒì…ë‹ˆë‹¤. ë§ˆê°ì „ ì•„ë˜ ë§í¬ë¡œ ì‹ ì²­í•˜ì„¸ìš”. bit.ly/gov_safe", 
                  opts: [{t:"ë‚´ ì§€ì›ê¸ˆ? ë§ˆê° ì „ì´ë‹ˆê¹Œ ì–¼ë¥¸ í´ë¦­!", s:'bad', f:"ğŸš¨ [í”¼í•´ë°œìƒ] ì •ë¶€ê¸°ê´€ì€ ì ˆëŒ€ ë‹¨ì¶• URLë¡œ ì•ˆë‚´í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í´ë¦­ ì¦‰ì‹œ ê°€ì§œ í”¼ì‹± ì‚¬ì´íŠ¸ë¡œ ì—°ê²°ë©ë‹ˆë‹¤."}, {t:"ì´ëŸ° ë¬¸ìëŠ” ë¬´ì‹œí•˜ê³  ì •ë¶€24 ê³µì‹ ì•±ì—ì„œ í™•ì¸í•œë‹¤.", s:'good', f:"âœ… [ì •ë‹µ] ë¬¸ìì˜ ë§í¬ëŠ” ì ˆëŒ€ ëˆ„ë¥´ì§€ ì•ŠëŠ” ê²ƒì´ ì² ì¹™ì…ë‹ˆë‹¤."}] },
                { txt: "[2ë‹¨ê³„] (ê°€ì§œ ì‚¬ì´íŠ¸ ì ‘ì†ë¨) ë³¸ì¸ í™•ì¸ ë° ì…ê¸ˆì„ ìœ„í•´ ì„±í•¨, ì£¼ë¯¼ë²ˆí˜¸, ê³„ì¢Œë²ˆí˜¸, ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.", 
                  opts: [{t:"ì…ê¸ˆ ë°›ì•„ì•¼ í•˜ë‹ˆê¹Œ ë‹¤ ì ì–´ì•¼ì§€. (ì „ì†¡)", s:'bad', f:"ğŸš¨ [ìœ„í—˜] ì€í–‰ì´ë‚˜ ì •ë¶€ëŠ” ì ˆëŒ€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ìš”êµ¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê°œì¸ì •ë³´ íƒˆì·¨ê°€ ëª©ì ì…ë‹ˆë‹¤."}, {t:"ë¹„ë°€ë²ˆí˜¸ê¹Œì§€ ë¬»ë‹¤ë‹ˆ ê°€ì§œë‹¤! ì¦‰ì‹œ ì¢…ë£Œ.", s:'good', f:"âœ… [ì •ë‹µ] ê³¼ë„í•œ ê°œì¸ì •ë³´ ì…ë ¥ì„ ìš”êµ¬í•˜ë©´ ì¦‰ì‹œ ì ‘ì†ì„ ì¤‘ë‹¨í•´ì•¼ í•©ë‹ˆë‹¤."}] },
                { txt: "[3ë‹¨ê³„] ì§€ì›ê¸ˆ ì§€ê¸‰ ìŠ¹ì¸ì„ ìœ„í•´ 'ì •ë¶€ í†µí•© ë³´ì•ˆ ì•±'ì„ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤. ë‹¤ìš´ë¡œë“œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (APK íŒŒì¼)", 
                  opts: [{t:"ì •ì‹ ì•±ì´ë¼ë‹ˆê¹Œ ë¯¿ê³  ì„¤ì¹˜í•œë‹¤.", s:'bad', f:"ğŸš¨ [í”¼í•´ë°œìƒ] íŒŒì¼(.apk)ì„ ì„¤ì¹˜í•˜ë©´ í°ì˜ ì›ê²© ì œì–´ê¶Œì´ ì‚¬ê¸°ê¾¼ì—ê²Œ ë„˜ì–´ê°‘ë‹ˆë‹¤."}, {t:"ìŠ¤í† ì–´ ì™¸ì˜ íŒŒì¼ì€ ì ˆëŒ€ ì•ˆ ê¹ë‹¤.", s: 'good', f: "âœ… [ì™„ë²½í•´ìš”] ë¬¸ìë¡œ ë³´ë‚´ì£¼ëŠ” ì•± ì„¤ì¹˜ íŒŒì¼ì€ ê°€ì¥ ìœ„í—˜í•œ í•´í‚¹ ë„êµ¬ì…ë‹ˆë‹¤." }] },
                { txt: "[4ë‹¨ê³„] ë³¸ì¸ ì¸ì¦ì„ ìœ„í•´ íœ´ëŒ€í°ìœ¼ë¡œ ë°œì†¡ëœ ì¸ì¦ë²ˆí˜¸ 6ìë¦¬ë¥¼ ì§€ê¸ˆ ì…ë ¥í•´ ì£¼ì„¸ìš”.", 
                  opts: [{t:"ë¬¸ì ì™”ë„¤. 123456.. ì…ë ¥ ì™„ë£Œ!", s:'bad', f:"ğŸš¨ [í”¼í•´ë°œìƒ] ì´ëŠ” ì†Œì•¡ê²°ì œ ìŠ¹ì¸ë²ˆí˜¸ì´ê±°ë‚˜ ë³¸ì¸ ëª°ë˜ íœ´ëŒ€í°ì„ ê°œí†µí•˜ëŠ” ì¸ì¦ë²ˆí˜¸ì…ë‹ˆë‹¤."}, {t:"ì¸ì¦ë²ˆí˜¸ëŠ” ì ˆëŒ€ ëˆ„êµ¬ì—ê²Œë„ ì•ˆ ì•Œë ¤ì¤€ë‹¤.", s:'good', f:"âœ… [ì •ë‹µ] ì¸ì¦ë²ˆí˜¸ëŠ” í˜„ê¸ˆê³¼ ê°™ìŠµë‹ˆë‹¤. íƒ€ì¸ì˜ ìš”ì²­ì— ì ˆëŒ€ ì‘í•˜ì§€ ë§ˆì„¸ìš”."}] },
                { txt: "[5ë‹¨ê³„] (ì§€ì¸ ì‚¬ì¹­ ì—°ê³„) ê°‘ìê¸° ë”¸ì—ê²Œ ë¬¸ìê°€ ì˜´: 'ì—„ë§ˆ, ë‚˜ í° ì•¡ì • ê¹¨ì ¸ì„œ ìˆ˜ë¦¬ ì¤‘ì´ì•¼. ê¸‰í•œë° ë¬¸í™”ìƒí’ˆê¶Œ 50ë§Œì›ë§Œ ì‚¬ì„œ ë²ˆí˜¸ ë³´ë‚´ì¤˜.'", 
                  opts: [{t:"ìš°ë¦¬ ë”¸ í°ì¼ ë‚¬ë„¤! ì•Œì•˜ì–´, ì–¼ë¥¸ ì‚¬ì¤„ê²Œ.", s:'bad', f:"ğŸš¨ [í”¼í•´ë°œìƒ] ì „í˜•ì ì¸ ë©”ì‹ ì € í”¼ì‹±ì…ë‹ˆë‹¤. í° ê³ ì¥ í•‘ê³„ë¡œ ëª©ì†Œë¦¬ í™•ì¸ì„ í”¼í•©ë‹ˆë‹¤."}, {t:"ë„ˆ ëˆ„êµ¬ì•¼? ì›ë˜ ë²ˆí˜¸ë¡œ ì „í™”í•´ ë´. ëª©ì†Œë¦¬ ë“¤ì–´ì•¼ í•´.", s:'good', f:"âœ… [ì •ë‹µ] ì§€ì¸ì„ ì‚¬ì¹­í•œ ê¸ˆì „ ìš”êµ¬ëŠ” ë°˜ë“œì‹œ ëª©ì†Œë¦¬ë¥¼ ì§ì ‘ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤."}] }
            ]
        }
    };
    
    SCENARIOS['loan'] = SCENARIOS['prosecutor'];
    SCENARIOS['family'] = SCENARIOS['smishing'];
    SCENARIOS['romance'] = SCENARIOS['prosecutor'];
    SCENARIOS['invest'] = SCENARIOS['loan'];

    let curType = '', curStep = 0, totalScore = 0, history = [];
    const ringtone = document.getElementById('ringtone');
    const voicePlayer = document.getElementById('voice-player');
    const sirenPlayer = document.getElementById('siren-sound');

    function switchTab(id, el) {
        document.querySelectorAll('.content-view').forEach(v => v.classList.remove('active'));
        document.getElementById('view-' + id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
    }

    function startSim(type) {
        curType = type; curStep = 0; totalScore = 0; history = [];
        const data = SCENARIOS[type];
        document.getElementById('simCaller').innerText = data.caller;
        document.getElementById('incomingName').innerText = data.caller;
        voicePlayer.src = data.voice;
        
        document.getElementById('simScreen').classList.add('show');
        document.getElementById('callIncoming').style.display = 'flex';
        document.getElementById('listeningBox').classList.add('hidden');
        document.getElementById('scenarioBox').classList.add('hidden');
        
        ringtone.currentTime = 0;
        ringtone.play().catch(e=>{});
        if (navigator.vibrate) navigator.vibrate([1000, 1000, 1000]);
    }

    function declineCall() {
        ringtone.pause();
        if (navigator.vibrate) navigator.vibrate(0);
        document.getElementById('simScreen').classList.remove('show');
        alert("ìµœê³ ì˜ íŒë‹¨ì…ë‹ˆë‹¤! ëª¨ë¥´ëŠ” ì „í™”ëŠ” ì•„ì˜ˆ ë°›ì§€ ì•ŠëŠ” ê²ƒì´ ê°€ì¥ ì•ˆì „í•©ë‹ˆë‹¤.");
        location.reload();
    }

    function acceptCall() {
        ringtone.pause();
        if (navigator.vibrate) navigator.vibrate(0);
        document.getElementById('callIncoming').style.display = 'none';
        document.getElementById('listeningBox').classList.remove('hidden');
        
        voicePlayer.play()
            .then(() => {
                voicePlayer.onended = finishListening;
            })
            .catch(e => {
                console.log("Audio file missing, bypass.");
                finishListening(); 
            });
    }

    function finishListening() {
        document.getElementById('listeningBox').classList.add('hidden');
        document.getElementById('scenarioBox').classList.remove('hidden');
        renderStep();
    }

    function renderStep() {
        const step = SCENARIOS[curType].steps[curStep];
        document.getElementById('simStepInfo').innerText = `ì§„í–‰ ë‹¨ê³„: ${curStep + 1} / 5`;
        document.getElementById('scenarioText').innerText = step.txt;
        
        const optsArea = document.getElementById('optionsArea');
        optsArea.innerHTML = '';
        
        step.opts.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt.t;
            btn.onclick = function() { selectOpt(this, opt.s, opt.f); };
            optsArea.appendChild(btn);
        });

        document.getElementById('feedbackArea').style.display = 'none';
        document.getElementById('nextBtn').classList.add('hidden');
    }

    function selectOpt(btn, type, feedback) {
        document.querySelectorAll('.option-btn').forEach(b => {
            b.style.pointerEvents = 'none';
            b.style.opacity = '0.3';
        });
        btn.style.opacity = '1';
        
        if (type === 'good') {
            btn.classList.add('good');
            totalScore += 20;
        } else {
            btn.classList.add('bad');
            triggerSirenShock();
        }

        const fbBox = document.getElementById('feedbackArea');
        fbBox.className = `feedback-box ${type === 'good' ? 'good' : 'bad'}`;
        fbBox.style.display = 'block';
        fbBox.innerHTML = `<strong>${type === 'good' ? 'ì˜í•˜ì…¨ìŠµë‹ˆë‹¤! ğŸ‘' : 'ìœ„í—˜í•©ë‹ˆë‹¤! ğŸš¨'}</strong><br>${feedback}`;
        
        history.push(feedback);
        
        const nextBtn = document.getElementById('nextBtn');
        nextBtn.classList.remove('hidden');
        if (curStep >= 4) {
            nextBtn.innerHTML = 'ì§„ë‹¨ ê²°ê³¼ í™•ì¸ <i class="fa-solid fa-file-waveform ml-1"></i>';
            nextBtn.onclick = showResult;
        }
    }

    function triggerSirenShock() {
        const overlay = document.getElementById('siren-overlay');
        overlay.classList.remove('hidden');
        overlay.classList.add('siren-effect');
        
        sirenPlayer.currentTime = 0;
        sirenPlayer.play().catch(e=>{});
        if (navigator.vibrate) navigator.vibrate([300, 100, 300, 100, 300, 100]);

        setTimeout(() => {
            overlay.classList.add('hidden');
            overlay.classList.remove('siren-effect');
            sirenPlayer.pause();
        }, 1500);
    }

    function nextStep() {
        curStep++;
        renderStep();
    }

    function showResult() {
        document.getElementById('simScreen').classList.remove('show');
        document.getElementById('resultScreen').classList.remove('hidden');
        
        const score = Math.min(Math.round(totalScore), 100);
        document.getElementById('finalScore').innerText = score;
        
        const circle = document.getElementById('scoreCircle');
        const grade = document.getElementById('finalGrade');

        if (score >= 80) {
            circle.className = "relative w-36 h-36 mx-auto flex items-center justify-center rounded-full border-[10px] border-blue-500 text-blue-600";
            grade.innerText = "ì•ˆì „ ë“±ê¸‰: ì–‘í˜¸ (Great)";
            grade.style.color = "#2563eb";
        } else {
            circle.className = "relative w-36 h-36 mx-auto flex items-center justify-center rounded-full border-[10px] border-red-500 text-red-600";
            grade.innerText = "ì•ˆì „ ë“±ê¸‰: ìœ„í—˜ (Danger)";
            grade.style.color = "#dc2626";
        }

        const list = document.getElementById('feedbackList');
        list.innerHTML = '';
        history.forEach(fb => {
            list.innerHTML += `<li class="border-b border-gray-100 pb-2 mb-2 last:border-0">${fb}</li>`;
        });
    }

    function quitSim() {
        location.reload();
    }
</script>

</body>
</html>
