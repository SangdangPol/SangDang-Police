<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>청주상당경찰서 피싱 가드</title>
    <style>
        /* [디자인 시스템: Dark Neon Glass Theme] */
        :root {
            --bg-main: #0f172a;
            --bg-card: rgba(30, 41, 59, 0.7);
            --primary: #3b82f6;
            --accent: #0ea5e9;
            --danger: #ef4444;
            --safe: #22c55e;
            --text-light: #f8fafc;
            --text-dim: #94a3b8;
            --glass-border: 1px solid rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Apple SD Gothic Neo', sans-serif;
            margin: 0; background-color: #000; color: var(--text-light);
            display: flex; justify-content: center; height: 100vh; overflow: hidden;
            background-image: linear-gradient(to bottom, #0f172a, #000);
        }

        .app-frame {
            width: 100%; max-width: 450px; height: 100%;
            display: flex; flex-direction: column; position: relative;
            background: var(--bg-main);
            box-shadow: 0 0 50px rgba(59, 130, 246, 0.1);
        }

        /* [헤더] */
        .header {
            padding: 15px 20px; display: flex; align-items: center; justify-content: space-between;
            border-bottom: var(--glass-border); background: rgba(15, 23, 42, 0.9); z-index: 50;
            backdrop-filter: blur(10px);
        }
        .brand { display: flex; align-items: center; gap: 12px; font-weight: 700; font-size: 16px; letter-spacing: -0.5px; }
        .brand-logo { width: 36px; height: 36px; object-fit: contain; filter: drop-shadow(0 0 5px rgba(255,255,255,0.2)); }
        .dept-tag { 
            background: linear-gradient(135deg, var(--primary), var(--accent));
            padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: bold;
            box-shadow: 0 2px 10px rgba(59, 130, 246, 0.3);
        }

        /* [컨텐츠 영역 공통] */
        .content-view {
            flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 90px;
            display: none; animation: fadeIn 0.3s ease-out;
        }
        .content-view.active { display: block; }

        /* [탭 1: 홈] */
        .hero-banner {
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            padding: 25px; border-radius: 20px; margin-bottom: 30px; position: relative; overflow: hidden;
            box-shadow: 0 10px 30px -10px rgba(59, 130, 246, 0.4); border: var(--glass-border);
        }
        .hero-banner h1 { margin: 0; font-size: 22px; font-weight: 800; line-height: 1.3; }
        .hero-banner p { margin: 8px 0 0; opacity: 0.8; font-size: 13px; }
        .hero-icon { position: absolute; right: -20px; bottom: -20px; font-size: 100px; opacity: 0.1; transform: rotate(-10deg); }

        .section-label { font-size: 14px; color: var(--accent); font-weight: bold; margin-bottom: 15px; display: block; }
        .grid-menu { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .menu-card {
            background: var(--bg-card); border: var(--glass-border); padding: 20px; border-radius: 18px;
            text-align: center; cursor: pointer; transition: all 0.2s; position: relative; overflow: hidden;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .menu-card:active { transform: scale(0.97); background: rgba(59, 130, 246, 0.2); }
        .menu-card::before { content:''; position: absolute; top:0; left:0; width:100%; height:4px; background: var(--menu-color, #ccc); }
        .menu-icon { font-size: 32px; margin-bottom: 10px; display: block; }
        .menu-title { font-weight: bold; font-size: 15px; margin-bottom: 4px; }
        .menu-desc { font-size: 11px; color: var(--text-dim); }

        /* [탭 2: 스미싱 탐지] */
        .quiz-card {
            background: var(--bg-card); border: var(--glass-border); border-radius: 18px; padding: 20px; margin-bottom: 20px;
        }
        .quiz-msg {
            background: #e2e8f0; color: #1e293b; padding: 15px; border-radius: 10px; font-size: 14px; line-height: 1.5;
            margin: 15px 0; border-left: 4px solid var(--primary);
        }
        .quiz-btn-group { display: flex; gap: 10px; }
        .quiz-btn {
            flex: 1; padding: 12px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer;
            font-size: 14px; transition: transform 0.1s;
        }
        .q-fake { background: rgba(239, 68, 68, 0.2); color: #fca5a5; border: 1px solid rgba(239, 68, 68, 0.3); }
        .q-real { background: rgba(34, 197, 94, 0.2); color: #86efac; border: 1px solid rgba(34, 197, 94, 0.3); }
        .quiz-btn:active { transform: scale(0.95); }

        /* [탭 3: 예방 가이드] - CI 로고 적용 */
        .guide-title-box {
            display: flex; align-items: center; gap: 10px; margin-bottom: 20px;
        }
        .guide-ci {
            width: 24px; height: 24px; object-fit: contain;
        }
        .guide-item {
            display: flex; gap: 15px; background: var(--bg-card); padding: 20px; border-radius: 18px;
            border: var(--glass-border); margin-bottom: 15px; align-items: center;
        }
        .g-num { font-size: 24px; font-weight: 900; color: var(--accent); opacity: 0.8; }
        .g-txt h3 { margin: 0 0 5px 0; font-size: 16px; color: white; }
        .g-txt p { margin: 0; font-size: 13px; color: var(--text-dim); line-height: 1.4; }

        /* [시뮬레이션 및 결과 오버레이] */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 100;
            background: #000; display: none; flex-direction: column;
        }
        .overlay.active { display: flex; }

        .call-screen {
            flex: 1; display: flex; flex-direction: column; justify-content: space-between; padding: 80px 30px;
            background: radial-gradient(circle at center, #1e293b 0%, #000 100%);
        }
        .caller-info { text-align: center; margin-top: 40px; }
        .c-name { font-size: 32px; font-weight: 700; margin-bottom: 10px; }
        .c-loc { font-size: 14px; color: var(--text-dim); }
        .call-actions { display: flex; justify-content: space-around; width: 100%; }
        .c-btn { width: 75px; height: 75px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 32px; color: white; cursor: pointer; }
        .btn-red { background: var(--danger); }
        .btn-green { background: var(--safe); animation: pulse 1.5s infinite; }

        .chat-screen { flex: 1; display: flex; flex-direction: column; background: #0f172a; display: none; }
        .chat-body { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .bubble { max-width: 80%; padding: 14px 18px; border-radius: 18px; font-size: 15px; line-height: 1.5; animation: slideUp 0.3s; }
        .b-them { background: #334155; color: white; align-self: flex-start; }
        .b-me { background: var(--primary); color: white; align-self: flex-end; }
        .choice-area { background: #1e293b; padding: 25px 20px; border-radius: 25px 25px 0 0; }
        .choice-btn { width: 100%; padding: 16px; margin-bottom: 10px; background: rgba(255,255,255,0.1); color: white; border-radius: 12px; text-align: left; cursor: pointer; display: flex; justify-content: space-between; }

        .result-screen {
            flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 30px; text-align: center; background: radial-gradient(circle at center, #1e293b 0%, #000 100%); display: none;
        }
        .score-circle {
            width: 160px; height: 160px; border-radius: 50%; border: 8px solid #334155;
            display: flex; flex-direction: column; align-items: center; justify-content: center; margin-bottom: 30px;
        }
        .score-circle.safe { border-color: var(--safe); }
        .score-circle.danger { border-color: var(--danger); }
        .s-num { font-size: 48px; font-weight: 900; color: white; }

        /* [하단 탭바] - 세련된 아이콘 적용 */
        .bottom-nav {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; height: 65px; background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(20px);
            border-radius: 35px; border: var(--glass-border); display: flex; justify-content: space-around; align-items: center;
            z-index: 50; box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            font-size: 10px; color: var(--text-dim); cursor: pointer; width: 60px;
        }
        /* SVG 아이콘 스타일 */
        .nav-icon-svg {
            width: 24px; height: 24px; fill: var(--text-dim); transition: all 0.2s;
        }
        .nav-item.active { color: var(--accent); }
        .nav-item.active .nav-icon-svg {
            fill: var(--accent); transform: translateY(-3px);
            filter: drop-shadow(0 0 8px var(--accent)); /* 네온 효과 */
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(34, 197, 94, 0); } 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); } }

    </style>
</head>
<body>

<div class="app-frame">
    <audio id="ringtone" loop><source src="ringtone.mp3" type="audio/mpeg"></audio>

    <header class="header">
        <div class="brand">
            <img src="logo.png" alt="로고" class="brand-logo" onerror="this.src='https://cdn-icons-png.flaticon.com/512/1069/1069102.png'"> 
            <span>청주상당경찰서</span>
        </div>
        <span class="dept-tag">범죄예방대응과</span>
    </header>

    <div id="view-home" class="content-view active">
        <div class="hero-banner">
            <div class="hero-icon">👮</div>
            <h1>피싱 예방 훈련소</h1>
            <p>6대 범죄 유형을 가상 체험하고<br>당신의 대처 능력을 진단하세요.</p>
        </div>
        <span class="section-label">⚡ 체험할 범죄 유형 선택</span>
        <div class="grid-menu">
            <div class="menu-card" style="--menu-color:#3b82f6;" onclick="startSim('prosecutor')">
                <span class="menu-icon">⚖️</span>
                <div class="menu-title">기관 사칭</div>
                <div class="menu-desc">"검찰입니다"</div>
            </div>
            <div class="menu-card" style="--menu-color:#eab308;" onclick="startSim('loan')">
                <span class="menu-icon">💰</span>
                <div class="menu-title">대출 빙자</div>
                <div class="menu-desc">"저금리 대출"</div>
            </div>
            <div class="menu-card" style="--menu-color:#ec4899;" onclick="startSim('family')">
                <span class="menu-icon">📱</span>
                <div class="menu-title">자녀 사칭</div>
                <div class="menu-desc">"액정 깨졌어"</div>
            </div>
            <div class="menu-card" style="--menu-color:#a855f7;" onclick="startSim('romance')">
                <span class="menu-icon">💘</span>
                <div class="menu-title">로맨스 스캠</div>
                <div class="menu-desc">"파병 미군"</div>
            </div>
            <div class="menu-card" style="--menu-color:#22c55e;" onclick="startSim('smishing')">
                <span class="menu-icon">📩</span>
                <div class="menu-title">지원금 문자</div>
                <div class="menu-desc">"청주페이 적립"</div>
            </div>
            <div class="menu-card" style="--menu-color:#f97316;" onclick="startSim('invest')">
                <span class="menu-icon">📈</span>
                <div class="menu-title">투자 리딩방</div>
                <div class="menu-desc">"300% 수익"</div>
            </div>
        </div>
    </div>

    <div id="view-smishing" class="content-view">
        <div class="hero-banner" style="background: linear-gradient(135deg, #059669, #34d399);">
            <h1>스미싱 탐지소</h1>
            <p>문자 속 <strong>가짜(스미싱)</strong>를 찾아내세요.<br>선택 시 결과 화면으로 이동합니다.</p>
        </div>
        <div class="quiz-card">
            <div style="font-weight:bold; color:var(--text-light); margin-bottom:10px;">Q1. 모바일 청첩장</div>
            <div class="quiz-msg">
                [Web발신] 김철수♥이영희 결혼합니다.<br>
                모바일 청첩장: <strong>wedding.invitation.apk</strong>
            </div>
            <div class="quiz-btn-group">
                <button class="quiz-btn q-fake" onclick="checkQuiz(true, true, 'apk 파일은 악성 앱 설치 파일입니다.')">🚨 스미싱이다</button>
                <button class="quiz-btn q-real" onclick="checkQuiz(false, true, '틀렸습니다. apk 파일은 매우 위험합니다.')">✅ 정상 문자다</button>
            </div>
        </div>
        <div class="quiz-card">
            <div style="font-weight:bold; color:var(--text-light); margin-bottom:10px;">Q2. 택배 주소지 확인</div>
            <div class="quiz-msg">
                [CJ대한통운] 운송장번호[45***] 주소지 불분명.<br>
                확인하기: <strong>cj-gls.com.kr.xyz</strong>
            </div>
            <div class="quiz-btn-group">
                <button class="quiz-btn q-fake" onclick="checkQuiz(true, true, '공식 주소 뒤에 xyz 등 이상한 영어가 붙으면 100% 가짜입니다.')">🚨 스미싱이다</button>
                <button class="quiz-btn q-real" onclick="checkQuiz(false, true, '틀렸습니다. 택배사는 링크를 보내지 않습니다.')">✅ 정상 문자다</button>
            </div>
        </div>
    </div>

    <div id="view-guide" class="content-view">
        <div class="guide-title-box">
            <img src="logo.png" alt="CI" class="guide-ci" onerror="this.src='https://cdn-icons-png.flaticon.com/512/1069/1069102.png'">
            <span class="section-label" style="margin-bottom:0; font-size:18px;">범죄예방대응과 행동수칙</span>
        </div>
        <div class="guide-item">
            <div class="g-num">01</div>
            <div class="g-txt"><h3>링크(URL) 클릭 금지</h3><p>출처를 알 수 없는 문자 속 인터넷 주소는 절대 누르지 마세요.</p></div>
        </div>
        <div class="guide-item">
            <div class="g-num">02</div>
            <div class="g-txt"><h3>앱 설치 요구는 사기</h3><p>기관은 전화로 '보안 앱' 설치를 요구하지 않습니다.</p></div>
        </div>
        <div class="guide-item">
            <div class="g-num">03</div>
            <div class="g-txt"><h3>끊고, 확인 전화</h3><p>의심스러운 전화를 받았다면 끊고 112로 확인하세요.</p></div>
        </div>
    </div>

    <div id="sim-overlay" class="overlay">
        <div id="screen-call" class="call-screen">
            <div class="caller-info"><div class="c-sub">수신 전화</div><div id="sim-name" class="c-name">발신자</div><div id="sim-loc" class="c-loc">South Korea</div></div>
            <div class="call-actions"><div class="c-btn btn-red" onclick="endSim(100)">📞</div><div class="c-btn btn-green" onclick="answerCall()">📞</div></div>
        </div>
        <div id="screen-chat" class="chat-screen">
            <div class="chat-header">통화 중</div>
            <div id="chat-box" class="chat-body"></div>
            <div id="choice-dock" class="choice-area"></div>
        </div>
        <div id="screen-result" class="result-screen">
            <div id="res-circle" class="score-circle">
                <span id="res-score" class="s-num">0</span>
            </div>
            <div id="res-title" class="res-title">결과</div>
            <div id="res-desc" class="res-desc">설명</div>
            <button onclick="closeSim()" style="padding:15px 40px; border-radius:30px; border:none; background:var(--primary); color:white; font-weight:bold; cursor:pointer;">돌아가기</button>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('home', this)">
            <svg class="nav-icon-svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
            <span>훈련소</span>
        </div>
        <div class="nav-item" onclick="switchTab('smishing', this)">
            <svg class="nav-icon-svg" viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
            <span>스미싱</span>
        </div>
        <div class="nav-item" onclick="switchTab('guide', this)">
            <svg class="nav-icon-svg" viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/></svg>
            <span>가이드</span>
        </div>
    </div>

</div>

<script>
    /* [화면 전환] */
    function switchTab(viewId, element) {
        document.querySelectorAll('.content-view').forEach(el => el.classList.remove('active'));
        document.getElementById('view-' + viewId).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        element.classList.add('active');
    }

    /* [시나리오 데이터] */
    const DB = {
        'prosecutor': { caller: '서울중앙지검', loc: 'Seoul', steps: [{ t: "서울중앙지검 김민수 검사입니다. 귀하의 명의가 대포통장 사기에 연루되었습니다.", opt: [{tx:"네? 대포통장이요?", sc:-20, nx:1}, {tx:"무슨 사건이죠? 소속 대세요.", sc:0, nx:99}] }, { t: "피해자 입증을 못하시면 구속 수사 됩니다. 지금 보내드리는 보안 앱을 설치해서 인증하세요.", opt: [{tx:"알겠습니다. 설치할게요.", sc:-80, nx:-1}, {tx:"직접 출석하겠습니다. 끊습니다.", sc:0, nx:99}] }] },
        'loan': { caller: '1588-XXXX', loc: 'Bank', steps: [{ t: "고객님, 정부지원 저금리 대환대출 대상자로 선정되셨습니다. 금리 2.5%로 갈아타실 수 있습니다.", opt: [{tx:"정말요? 요즘 이자가 너무 비싸서...", sc:-20, nx:1}, {tx:"대출 권유 전화는 불법입니다.", sc:0, nx:99}] }, { t: "네, 그런데 기존 대출금을 일부 상환하셔야 실행이 가능합니다. 알려드리는 가상계좌로 먼저 입금하세요.", opt: [{tx:"계좌번호 주시면 넣을게요.", sc:-80, nx:-1}, {tx:"남의 통장으로 입금하는 건 보이스피싱이죠.", sc:0, nx:99}] }] },
        'family': { caller: '내 딸♡', loc: 'Mobile', steps: [{ t: "엄마, 나 폰 액정 깨져서 수리 맡겼어. 급한데 엄마 카드로 편의점 상품권 좀 사서 번호만 보내줄 수 있어?", opt: [{tx:"어머, 많이 다친 건 아니니? 바로 사줄게.", sc:-50, nx:-1}, {tx:"원래 번호로 전화해 볼게. 목소리 들어야 해.", sc:0, nx:99}] }] },
        'romance': { caller: 'James Kim', loc: 'Overseas', steps: [{ t: "Honey, 나 파병 끝났어. 한국 들어가서 너랑 살고 싶어. 내 짐이랑 금괴를 한국으로 먼저 보낼 건데 통관비 300만원이 필요해.", opt: [{tx:"어머, 정말? 내가 통관비 보내줄게.", sc:-100, nx:-1}, {tx:"얼굴 한 번 안 본 사람한테 돈을 왜 보내?", sc:0, nx:99}] }] },
        'smishing': { caller: '청주시청', loc: 'Cheongju', steps: [{ t: "홍길동님, 귀하는 청주페이 추가 적립(30만원) 대상자입니다. 기한 내 아래 링크로 신청하세요. (url 클릭 유도)", opt: [{tx:"(링크를 누른다)", sc:-100, nx:-1}, {tx:"시청은 문자로 링크 안 보냅니다.", sc:0, nx:99}] }] },
        'invest': { caller: '김사부 팀장', loc: 'Investment', steps: [{ t: "회원님, 이번에 저희 VIP 리딩방에 초대되셨습니다. 300% 수익 보장되는 종목 알려드립니다.", opt: [{tx:"정말 300%요? 어떻게 하면 되나요?", sc:-30, nx:1}, {tx:"원금 보장은 사기입니다.", sc:0, nx:99}] }, { t: "일단 시드머니 1,000만원만 저희 거래소 계좌로 입금하시면 내일 바로 3배 불려드립니다.", opt: [{tx:"네, 지금 바로 입금하겠습니다.", sc:-70, nx:-1}, {tx:"금융위에 등록된 업체 맞나요? 신고합니다.", sc:0, nx:99}] }] }
    };

    let curData = null;
    let curScore = 100;

    /* 시뮬레이션 로직 */
    function startSim(type) {
        curData = DB[type];
        curScore = 100;
        document.getElementById('sim-name').innerText = curData.caller;
        document.getElementById('sim-loc').innerText = curData.loc;
        document.getElementById('sim-overlay').classList.add('active');
        ['screen-call', 'screen-chat', 'screen-result'].forEach(i => document.getElementById(i).style.display = 'none');
        document.getElementById('screen-call').style.display = 'flex';
        
        let audio = document.getElementById('ringtone');
        if(audio) { audio.currentTime = 0; audio.play().catch(e=>{}); }
        if(navigator.vibrate) navigator.vibrate([1000, 500, 1000]);
    }

    function endSim(score) {
        ['screen-call', 'screen-chat', 'screen-result'].forEach(i => document.getElementById(i).style.display = 'none');
        document.getElementById('screen-result').style.display = 'flex';
        
        let circle = document.getElementById('res-circle');
        let title = document.getElementById('res-title');
        let desc = document.getElementById('res-desc');
        let sNum = document.getElementById('res-score');
        
        let audio = document.getElementById('ringtone');
        if(audio) audio.pause();

        sNum.innerText = score;

        if(score >= 90) {
            circle.className = "score-circle safe";
            title.innerText = "방어 성공";
            title.style.color = "var(--safe)";
            desc.innerText = "훌륭합니다! 침착하게 대응하셨습니다.";
        } else {
            circle.className = "score-circle danger";
            title.innerText = "피해 발생";
            title.style.color = "var(--danger)";
            desc.innerText = "범죄 수법에 넘어갔습니다. 의심하고 확인하세요!";
        }
    }

    /* 스미싱 퀴즈 결과 로직 */
    function checkQuiz(userChoiceIsFake, isActuallyFake, explanation) {
        let isCorrect = (userChoiceIsFake === isActuallyFake);
        let score = isCorrect ? 100 : 0;
        
        document.getElementById('sim-overlay').classList.add('active');
        ['screen-call', 'screen-chat', 'screen-result'].forEach(i => document.getElementById(i).style.display = 'none');
        document.getElementById('screen-result').style.display = 'flex';

        let circle = document.getElementById('res-circle');
        let title = document.getElementById('res-title');
        let desc = document.getElementById('res-desc');
        let sNum = document.getElementById('res-score');

        sNum.innerText = score;

        if (isCorrect) {
            circle.className = "score-circle safe";
            title.innerText = "정답입니다!";
            title.style.color = "var(--safe)";
            desc.innerText = explanation;
        } else {
            circle.className = "score-circle danger";
            title.innerText = "오답입니다!";
            title.style.color = "var(--danger)";
            desc.innerText = explanation;
        }
    }

    function closeSim() {
        document.getElementById('sim-overlay').classList.remove('active');
        let audio = document.getElementById('ringtone');
        if(audio) audio.pause();
    }

    function answerCall() {
        if(navigator.vibrate) navigator.vibrate(0);
        let audio = document.getElementById('ringtone');
        if(audio) audio.pause();

        document.getElementById('screen-call').style.display = 'none';
        document.getElementById('screen-chat').style.display = 'flex';
        document.getElementById('chat-box').innerHTML = '';
        playStep(0);
    }

    function playStep(idx) {
        if(idx === 99 || idx === -1) { endSim(curScore); return; }
        let step = curData.steps[idx];

        addBubble('them', '...');
        setTimeout(() => {
            let bubbles = document.querySelectorAll('.b-them');
            bubbles[bubbles.length-1].innerText = step.t;
            let html = '';
            step.opt.forEach(o => {
                html += `<div class="choice-btn" onclick="choose('${o.tx}', ${o.sc}, ${o.nx})">
                            <span>${o.tx}</span> <span>👉</span>
                         </div>`;
            });
            document.getElementById('choice-dock').innerHTML = html;
        }, 600);
    }

    function choose(txt, score, next) {
        curScore += score;
        addBubble('me', txt);
        document.getElementById('choice-dock').innerHTML = '';
        setTimeout(() => playStep(next), 500);
    }

    function addBubble(type, txt) {
        let box = document.getElementById('chat-box');
        let div = document.createElement('div');
        div.className = `bubble b-${type}`;
        div.innerText = txt;
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    }
</script>

</body>
</html>