<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>폴-체크 (안전 자가진단)</title>
    <meta name="theme-color" content="#15803d">
    
    <!-- [보안] 데이터 암호화 라이브러리 연동 (AES-256) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    
    <!-- 아이콘 & 스타일 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- [성과분석] 구글 애널리틱스 (GA4) 연동 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PFC08R08MG"></script>
    <script>
        const GA_MEASUREMENT_ID = 'G-PFC08R08MG';
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', GA_MEASUREMENT_ID, { 'page_title': '폴-체크(자가진단)', 'anonymize_ip': true });
        function sendAnalyticsEvent(eventName, params = {}) { gtag('event', eventName, params); }
    </script>

    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f0fdf4; touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
        .custom-checkbox:checked {
            background-color: #16a34a; border-color: #16a34a;
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
        }
        .advice-box { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .bg-police-dark { background-color: #1a237e; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center">

    <div class="w-full max-w-md bg-white min-h-screen shadow-2xl flex flex-col relative">
        
        <!-- 헤더 (원본 UI 유지) -->
        <header class="bg-green-700 text-white p-4 flex items-center justify-between sticky top-0 z-20 shadow-md">
            <div class="flex items-center gap-3">
                <button onclick="location.href='../'" class="hover:bg-green-600 p-1 rounded-full transition mr-1">
                    <i class="fa-solid fa-arrow-left text-xl"></i>
                </button>
                <img src="logo.png" onerror="this.src='https://upload.wikimedia.org/wikipedia/commons/thumb/3/30/Emblem_of_the_Korean_National_Police_Agency.svg/150px-Emblem_of_the_Korean_National_Police_Agency.svg.png'" alt="CI" class="w-10 h-10 object-contain rounded-full">
                <div>
                    <h1 class="font-black text-lg leading-tight">폴-체크</h1>
                    <p class="text-xs text-green-200">범죄예방 환경진단</p>
                </div>
            </div>
            <i class="fa-solid fa-clipboard-check text-2xl opacity-50"></i>
        </header>

        <!-- 탭 메뉴 -->
        <div class="flex border-b border-gray-200 bg-white sticky top-[60px] z-10">
            <button onclick="switchTab('home')" id="tab-home" class="flex-1 py-4 font-bold text-green-700 border-b-4 border-green-700 bg-green-50 transition-all flex items-center justify-center gap-2">
                <i class="fa-solid fa-house"></i> 우리집
            </button>
            <button onclick="switchTab('store')" id="tab-store" class="flex-1 py-4 text-gray-400 hover:text-gray-600 hover:bg-gray-50 transition-all flex items-center justify-center gap-2">
                <i class="fa-solid fa-store"></i> 내 가게
            </button>
        </div>

        <main class="p-5 flex-1 overflow-y-auto pb-24 bg-gray-50">
            <div class="bg-white p-4 rounded-2xl shadow-sm border border-green-100 mb-6 text-center">
                <div class="inline-flex items-center justify-center w-12 h-12 bg-green-100 text-green-600 rounded-full mb-2">
                    <i class="fa-solid fa-shield-cat text-xl"></i>
                </div>
                <h2 class="text-lg font-bold text-gray-800" id="introTitle">우리집 안전점수 확인하기</h2>
                <p class="text-sm text-gray-500 mt-1">
                    <span id="displayUserName" class="text-green-700 font-bold">사용자</span>님,<br>
                    해당하는 항목에 체크(V) 해주세요.
                </p>
            </div>
            <div id="quiz-container" class="space-y-3"></div>
        </main>

        <div class="p-4 bg-white border-t border-gray-200 sticky bottom-0 z-20">
            <button onclick="calculateScore()" class="w-full bg-green-600 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-green-700 active:scale-95 transition flex items-center justify-center gap-2">
                <i class="fa-solid fa-magnifying-glass-chart"></i> 진단 결과 확인하기
            </button>
        </div>

        <!-- 결과 모달 -->
        <div id="resultModal" class="fixed inset-0 bg-black bg-opacity-70 z-50 hidden flex items-center justify-center p-4 transition-opacity duration-300">
            <div class="bg-white rounded-2xl w-full max-w-sm overflow-hidden relative shadow-2xl transform transition-transform duration-300 scale-95" id="modalContent">
                <div class="bg-green-700 p-4 text-white text-center relative">
                    <h3 class="font-bold text-lg">진단 결과 리포트</h3>
                    <button onclick="closeModal()" class="absolute top-4 right-4 text-white hover:text-green-200"><i class="fa-solid fa-xmark text-xl"></i></button>
                </div>
                <div class="p-6">
                    <div class="text-center mb-6">
                        <p class="text-gray-500 text-xs font-bold mb-1">현재 안전 점수</p>
                        <div class="text-6xl font-black text-green-600 mb-2 tracking-tighter" id="scoreDisplay">0</div>
                        <div id="gradeBadge" class="inline-block px-3 py-1 rounded-full text-white font-bold text-xs bg-gray-400">분석중...</div>
                    </div>
                    <div class="border-t border-gray-100 pt-4">
                        <h4 class="font-bold text-gray-800 text-sm mb-3 flex items-center gap-2"><i class="fa-solid fa-user-doctor text-green-600"></i>맞춤형 보안 솔루션</h4>
                        <div class="bg-green-50 rounded-xl p-3 h-48 overflow-y-auto space-y-2 custom-scrollbar" id="adviceList"></div>
                    </div>
                    <button onclick="closeModal()" class="w-full bg-gray-800 text-white py-3 rounded-lg font-bold mt-5 text-sm hover:bg-gray-900 transition">확인 완료</button>
                </div>
            </div>
        </div>

        <!-- 설정 모달 -->
        <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-70 z-50 hidden flex items-center justify-center p-4 modal">
            <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm overflow-hidden">
                <div class="bg-police-dark p-4 text-white text-center">
                    <h2 class="font-bold text-lg">사용자 설정</h2>
                    <p class="text-xs opacity-80">진단 결과에 표시될 이름을 입력하세요.</p>
                </div>
                <div class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">이름 (또는 닉네임)</label>
                        <input type="text" id="inputUserName" placeholder="예: 홍길동" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 bg-gray-50">
                    </div>
                    <button onclick="saveSettings()" class="w-full bg-police-dark text-white font-bold py-3 rounded-lg shadow hover:bg-blue-900 transition">저장하기</button>
                    <button onclick="document.getElementById('settingsModal').classList.add('hidden')" class="w-full text-gray-500 py-2 text-sm underline">닫기</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        /* [보안 레이어] AES-256 암호화 모듈 (난독화 패턴) */
        const _v_0x3 = "P0L_CH3CK_S3CR3T_K3Y_2024_SANGDANG";
        const _m_sec = {
            enc: (t) => t ? CryptoJS.AES.encrypt(t, _v_0x3).toString() : "",
            dec: (t) => {
                if (!t) return "";
                try { return CryptoJS.AES.decrypt(t, _v_0x3).toString(CryptoJS.enc.Utf8); }
                catch(e) { return ""; }
            }
        };

        const data = {
            home: [
                { q: "현관문에 이중 잠금장치</br>(안전고리, 보조키)가 있습니까?", advice: "현관문은 침입의 첫 관문입니다. 도어락 외에 '안전고리'를 설치하여 문을 열 때 안전을 확보하세요." },
                { q: "디지털 도어락 비밀번호를</br>3~6개월마다 변경합니까?", advice: "비밀번호 노출 방지를 위해 주기적으로 변경하고, 키패드에 남은 지문을 닦아주세요." },
                { q: "창문에 방범창 또는 락힌지</br>(잠금장치)가 설치되어 있습니까?", advice: "저층이나 복도식 아파트 창문은 침입이 쉽습니다. 창문 개방을 제한하는 '창문 스토퍼' 설치를 권장합니다." },
                { q: "집 앞이나 복도에 택배, 전단지가</br>쌓여있지 않습니까?", advice: "문 앞에 쌓인 적치물은 빈집임을 알리는 신호가 됩니다. 장기 부재 시 이웃에게 부탁하거나 택배함을 이용하세요." },
                { q: "가스배관에 덮개나 가시덮개가 설치되어 있습니까?", advice: "외부 배관을 타고 오르는 침입을 막기 위해 가시덮개 설치나 배관 주변 정리가 필요합니다." },
                { q: "공동현관(1층) 출입 통제가 잘 이루어지고 있습니까?", advice: "공동현관 비밀번호 노출을 주의하고, 외부인 출입 시 따라 들어오지 못하게 확인하세요." }
            ],
            store: [
                { q: "CCTV가 사각지대 없이 설치되어 있고,</br>'녹화중' 안내판이 있습니까?", advice: "CCTV는 범죄 심리를 억제하는 가장 효과적인 수단입니다. 눈에 잘 띄는 곳에 안내판을 부착하세요." },
                { q: "계산대(포스기)에 현금을 최소한으로만 보관합니까?", advice: "다액의 현금은 범죄의 표적이 됩니다. 수시로 금고나 은행에 입금하여 시재를 줄이세요." },
                { q: "출입문이나 유리창이 내부가</br>잘 보이도록 투명합니까?", advice: "내부가 잘 보여야(자연 감시) 외부 행인이나 순찰차가 범죄를 발견하기 쉽습니다. 불필요한 부착물을 제거하세요." },
                { q: "비상벨이나 긴급신고 시스템</br>(폴-매니저 등)을 사용 중입니까?", advice: "위급 상황 시 즉시 알릴 수 있는 수단을 마련하고, 직원들과 사용법을 숙지하세요." },
                { q: "고가품(귀금속 등)은 퇴근 시</br>별도 금고에 보관합니까?", advice: "고가품(귀금속)은 야간 침입 절도의 1순위 타겟입니다. 영업 종료 후 반드시 금고에 보관하세요." },
                { q: "매장 후문이나 창문의 시정장치가 견고합니까?", advice: "침입 범죄의 상당수는 허술한 뒷문이나 환기구를 통해 발생합니다. 견고한 이중 잠금장치를 설치하세요." }
            ]
        };

        let currentTab = 'home';

        document.addEventListener('DOMContentLoaded', () => {
            loadUserName();
            renderQuestions();
            sendAnalyticsEvent('app_open');
        });

        function switchTab(tab) {
            currentTab = tab;
            const btnHome = document.getElementById('tab-home');
            const btnStore = document.getElementById('tab-store');
            const title = document.getElementById('introTitle');
            if(tab === 'home') {
                btnHome.className = "flex-1 py-4 font-bold text-green-700 border-b-4 border-green-700 bg-green-50 transition-all flex items-center justify-center gap-2";
                btnStore.className = "flex-1 py-4 text-gray-400 hover:text-gray-600 hover:bg-gray-50 transition-all flex items-center justify-center gap-2";
                title.innerText = "우리집 안전점수 확인하기";
            } else {
                btnStore.className = "flex-1 py-4 font-bold text-green-700 border-b-4 border-green-700 bg-green-50 transition-all flex items-center justify-center gap-2";
                btnHome.className = "flex-1 py-4 text-gray-400 hover:text-gray-600 hover:bg-gray-50 transition-all flex items-center justify-center gap-2";
                title.innerText = "내 가게 안전점수 확인하기";
            }
            renderQuestions();
        }

        function renderQuestions() {
            const container = document.getElementById('quiz-container');
            container.innerHTML = '';
            data[currentTab].forEach((item, index) => {
                const id = `q-${index}`;
                container.innerHTML += `
                    <label class="flex items-start gap-3 p-4 bg-white rounded-xl border border-gray-200 cursor-pointer hover:border-green-500 hover:shadow-md transition-all active:scale-[0.99]" style="animation: fadeIn 0.3s ease-out ${index * 0.05}s backwards;">
                        <input type="checkbox" id="${id}" class="mt-1 w-6 h-6 border-2 border-gray-300 rounded text-green-600 focus:ring-green-500 custom-checkbox transition-colors">
                        <span class="text-gray-700 text-sm font-medium leading-relaxed select-none">${item.q}</span>
                    </label>
                `;
            });
        }

        function calculateScore() {
            const questions = data[currentTab];
            let checkedCount = 0;
            let adviceHTML = '';
            questions.forEach((item, index) => {
                const checkbox = document.getElementById(`q-${index}`);
                if(checkbox.checked) checkedCount++;
                else adviceHTML += `
                    <div class="advice-box flex gap-3 items-start p-2 border-b border-green-100 last:border-0">
                        <i class="fa-solid fa-circle-exclamation text-red-500 mt-1 flex-shrink-0"></i>
                        <span class="text-gray-600 text-xs leading-relaxed text-justify">${item.advice}</span>
                    </div>`;
            });

            const score = Math.round((checkedCount / questions.length) * 100);
            sendAnalyticsEvent('checklist_completed', { type: currentTab, score: score });

            const scoreEl = document.getElementById('scoreDisplay');
            scoreEl.innerText = score;
            const badge = document.getElementById('gradeBadge');
            const scoreColorClass = score >= 80 ? 'text-blue-600' : (score >= 50 ? 'text-yellow-500' : 'text-red-500');
            scoreEl.className = `text-6xl font-black mb-2 tracking-tighter ${scoreColorClass}`;

            if(score >= 80) { badge.innerText = "안심 단계 (Great)"; badge.className = "inline-block px-3 py-1 rounded-full text-white font-bold text-xs mb-4 bg-blue-500"; }
            else if(score >= 50) { badge.innerText = "관심 단계 (Caution)"; badge.className = "inline-block px-3 py-1 rounded-full text-white font-bold text-xs mb-4 bg-yellow-500"; }
            else { badge.innerText = "위험 단계 (Warning)"; badge.className = "inline-block px-3 py-1 rounded-full text-white font-bold text-xs mb-4 bg-red-500"; }

            const adviceList = document.getElementById('adviceList');
            adviceList.innerHTML = score === 100 ? `<div class="text-center text-blue-600 font-bold py-10 flex flex-col items-center"><div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-3"><i class="fa-solid fa-thumbs-up text-3xl"></i></div>완벽합니다!<br><span class="text-xs text-gray-500 font-normal mt-1">지금 상태를 잘 유지해주세요.</span></div>` : adviceHTML;

            /* [보안] 진단 결과 암호화 저장 */
            localStorage.setItem('pol_check_last_score', _m_sec.enc(score.toString()));

            const modal = document.getElementById('resultModal');
            const content = document.getElementById('modalContent');
            modal.classList.remove('hidden');
            setTimeout(() => { content.classList.remove('scale-95'); content.classList.add('scale-100'); }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('resultModal');
            const content = document.getElementById('modalContent');
            content.classList.remove('scale-100'); content.classList.add('scale-95');
            setTimeout(() => { modal.classList.add('hidden'); }, 200);
        }

        function saveSettings() {
            const name = document.getElementById('inputUserName').value.trim();
            if(name) {
                /* [보안] 사용자 이름 암호화 저장 */
                localStorage.setItem('pol_check_username', _m_sec.enc(name));
                loadUserName();
                document.getElementById('settingsModal').classList.add('hidden');
            } else { alert("이름을 입력해주세요."); }
        }

        function loadUserName() {
            /* [보안] 사용자 이름 복호화 로드 */
            const savedName = _m_sec.dec(localStorage.getItem('pol_check_username'));
            if(savedName) document.getElementById('displayUserName').innerText = savedName;
        }
    </script>
</body>
</html>
